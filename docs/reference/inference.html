<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>statistical inference on greta models — inference • greta</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="statistical inference on greta models — inference" />

<meta property="og:description" content="Carry out statistical inference on greta models by
  MCMC or likelihood/posterior optimisation." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">greta</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/get_started.html">get started</a>
</li>
<li>
  <a href="../articles/example_models.html">examples</a>
</li>
<li>
  <a href="../articles/faq.html">faq</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="../articles/technical_details.html">
    <span class="fa fa-flask"></span>
     
    technical details
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="https://github.com/greta-dev/greta">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>statistical inference on greta models</h1>
    <small class="dont-index">Source: <a href='https://github.com/greta-dev/greta/blob/master/R/inference.R'><code>R/inference.R</code></a></small>
    <div class="hidden name"><code>inference.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Carry out statistical inference on greta models by
  MCMC or likelihood/posterior optimisation.</p>
    
    </div>

    <pre class="usage"><span class='fu'>stashed_samples</span>()

<span class='fu'>mcmc</span>(<span class='no'>model</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'><a href='extract-replace-combine.html'>c</a></span>(<span class='st'>"hmc"</span>), <span class='kw'>n_samples</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>thin</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>warmup</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>pb_update</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'>list</span>(),
  <span class='kw'>initial_values</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>opt</span>(<span class='no'>model</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'><a href='extract-replace-combine.html'>c</a></span>(<span class='st'>"adagrad"</span>), <span class='kw'>max_iterations</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>tolerance</span> <span class='kw'>=</span> <span class='fl'>1e-06</span>,
  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'>list</span>(), <span class='kw'>initial_values</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>greta_model object</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>method used to sample or optimise values. Currently only
one method is available for each procedure: <code>hmc</code> and <code>adagrad</code></p></td>
    </tr>
    <tr>
      <th>n_samples</th>
      <td><p>number of MCMC samples to draw (after any warm-up, but
before thinning)</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>MCMC thinning rate; every <code>thin</code> samples is retained,
the rest are discarded</p></td>
    </tr>
    <tr>
      <th>warmup</th>
      <td><p>number of samples to spend warming up the mcmc sampler.
During this phase the sampler moves toward the highest density area and
tunes sampler hyperparameters.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>number of MCMC chains to run</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>whether to print progress information to the console</p></td>
    </tr>
    <tr>
      <th>pb_update</th>
      <td><p>how regularly to update the progress bar (in iterations)</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>an optional named list of hyperparameters and options to
control behaviour of the sampler or optimiser. See Details.</p></td>
    </tr>
    <tr>
      <th>initial_values</th>
      <td><p>an optional vector (or list of vectors, for multiple
chains) of initial values for the free parameters in the model. These will
be used as the starting point for sampling/optimisation.</p></td>
    </tr>
    <tr>
      <th>max_iterations</th>
      <td><p>the maximum number of iterations before giving up</p></td>
    </tr>
    <tr>
      <th>tolerance</th>
      <td><p>the numerical tolerance for the solution, the optimiser stops when the (absolute) difference in the joint density between successive iterations drops below this level</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>mcmc</code> &amp; <code>stashed_samples</code> - an <code>mcmc.list</code> object
  that can be analysed using functions from the coda package. This will
  contain mcmc samples of the greta arrays used to create <code>model</code>.</p>
<p><code>opt</code> - a list containing the following named elements:</p><ul>
<li><p>parthe best set of parameters found</p></li>
<li><p>valuethe log joint density of the model at the parameters par</p></li>
<li><p>iterationsthe number of iterations taken by the optimiser</p></li>
<li><p>convergencean integer code, 0 indicates successful completion, 1
    indicates the iteration limit max_iterations had been reached</p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If the sampler is aborted before finishing, the samples collected so
  far can be retrieved with <code>stashed_samples()</code>. Only samples from the
  sampling phase will be returned.</p>
<p>For <code>mcmc()</code> if <code>verbose = TRUE</code>, the progress bar shows
  the number of iterations so far and the expected time to complete the phase
  of model fitting (warmup or sampling). Updating the progress bar regularly
  slows down sampling, by as much as 9 seconds per 1000 updates. So if you
  want the sampler to run faster, you can change <code>pb_update</code> to increase
  the number of iterations between updates of the progress bar, or turn the
  progress bar off altogether by setting <code>verbose = FALSE</code>.</p>
<p>Occasionally, a proposed set of parameters can cause numerical instability
  (I.e. the log density or its gradient is <code>NA</code>, <code>Inf</code> or
  <code>-Inf</code>); normally because the log joint density is so low that it
  can't be represented as a floating point number. When this happens, the
  progress bar will also display the proportion of samples so far that were
  'bad' (numerically unstable) and therefore rejected.
  If you're getting a lot of numerical instability, you might want to
  manually define starting values to move the sampler into a more reasonable
  part of the parameter space. Alternatively, you could redefine the model
  (via <code>model</code>) to have double precision, though this will slow down
  sampling.</p>
<p>Currently, the only implemented MCMC procedure is static Hamiltonian Monte
  Carlo (<code>method = "hmc"</code>). During the warmup iterations, the leapfrog
  stepsize hyperparameter <code>epsilon</code> is tuned to maximise the sampler
  efficiency, and the posterior marginal standard deviations are estimated
  <code>diag_sd</code>. The <code>control</code> argument can be used to specify the
  initial value for <code>epsilon</code>, <code>diag_sd</code>, and two other
  hyperparameters: <code>Lmin</code> and <code>Lmax</code>; positive integers (with
  <code>Lmax &gt; Lmin</code>) giving the upper and lower limits to the number of
  leapfrog steps per iteration (from which the number is selected uniformly
  at random).</p>
<p>The default control options for HMC are:
  <code>control = list(Lmin = 10, Lmax = 20, epsilon = 0.005, diag_sd = 1)</code></p>
<p>Currently, the only implemented optimisation algorithm is Adagrad
  (<code>method = "adagrad"</code>). The <code>control</code> argument can be used to
  specify the optimiser hyperparameters: <code>learning_rate</code> (default 0.8),
  <code>initial_accumulator_value</code> (default 0.1) and <code>use_locking</code>
  (default <code>TRUE</code>). The are passed directly to TensorFlow's optimisers,
  see
  <a href='https://www.tensorflow.org/api_docs/python/tf/train/AdagradOptimizer'>the
  TensorFlow docs</a> for more information</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># define a simple model</span>
<span class='no'>mu</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='variable.html'>variable</a></span>()
<span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='distributions.html'>lognormal</a></span>(<span class='fl'>1</span>, <span class='fl'>0.1</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>rnorm</span>(<span class='fl'>10</span>)
<span class='fu'>distribution</span>(<span class='no'>x</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='distributions.html'>normal</a></span>(<span class='no'>mu</span>, <span class='no'>sigma</span>)
<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fu'>model</span>(<span class='no'>mu</span>, <span class='no'>sigma</span>)

<span class='co'># carry out mcmc on the model</span>
<span class='no'>draws</span> <span class='kw'>&lt;-</span> <span class='fu'>mcmc</span>(<span class='no'>m</span>,
              <span class='kw'>n_samples</span> <span class='kw'>=</span> <span class='fl'>100</span>,
              <span class='kw'>warmup</span> <span class='kw'>=</span> <span class='fl'>10</span>)
<span class='co'># }</span><span class='co'># NOT RUN {</span>
<span class='co'># find the MAP estimate</span>
<span class='no'>opt_res</span> <span class='kw'>&lt;-</span> <span class='fu'>opt</span>(<span class='no'>m</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Nick Golding.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

